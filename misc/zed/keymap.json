// Zed keymap
//
// For information on binding keys, see the Zed
// documentation: https://zed.dev/docs/key-bindings
//
// To see the default key bindings run `zed: open default keymap`
// from the command palette.
[
  // ============================================================================
  // INSERT MODE
  // ============================================================================
  {
    "context": "Editor && vim_mode == insert",
    "bindings": {
      "j j": "vim::NormalBefore", // jj to escape to normal mode
    },
  },

  // ============================================================================
  // NORMAL MODE
  // ============================================================================
  {
    "context": "Editor && vim_mode == normal",
    "bindings": {
      // LSP / Code Navigation
      // Note: gd, gD, K are built-in to Zed's vim mode with same keys
      "g r r": "editor::FindAllReferences", // Find all references
      "g r n": "editor::Rename", // Rename symbol
      "g r a": "editor::ToggleCodeActions", // Code actions
      "\\ o": "outline::Toggle", // Show outline

      // Leader key bindings (space is default leader)
      // File/Project Operations
      "space f": "pane::DeploySearch", // Text search in files
      "space p": "file_finder::Toggle", // File finder
      "space shift-p": "command_palette::Toggle", // Toggle command palette
      "space b": "tab_switcher::ToggleAll", // Show all buffers/tabs
      "space shift-s": "project_symbols::Toggle", // Find symbol in project
      "space \\": "workspace::ToggleLeftDock", // Toggle file explorer
      "space |": "pane::RevealInProjectPanel", // Reveal file in explorer
      "space ;": "workspace::ToggleRightDock",

      // Formatting
      "space =": "editor::Format", // Format document

      // Search and Replace
      "space s": ["pane::DeploySearch", { "replace_enabled": true }],

      // AI
      "space c l": ["agent::NewExternalAgentThread", { "agent": "claude_code" }],
      "space c c": ["agent::NewExternalAgentThread", { "agent": "codex" }],
      "space c o": [
        "agent::NewExternalAgentThread",
        {
          "agent": {
            "custom": {
              "name": "OpenCode",
              "command": {
                "command": "opencode",
                "args": ["acp"],
              },
            },
          },
        },
      ],

      // Debugger
      "space d b": "debugger::StepBack", // Step back
      "space d c": "debugger::Continue", // Continue
      "space d d": "debugger::Start",
      "space d i": "debugger::StepInto", // Step into
      "space d o": "debugger::StepOver", // Step over
      "space d p": "debugger::Pause", // Pause
      "space d q": "debugger::Stop", // Stop debugging
      "space d t": "editor::ToggleBreakpoint", // Toggle breakpoint
      "space d u": "debugger::StepOut", // Step out
      "space d x": "debugger::Stop", // Disconnect/stop
      "space d shift-c": "debugger::ClearAllBreakpoints", // Remove all breakpoints
      "space d shift-r": "debugger::RunToCursor", // Run to cursor
      "space d shift-x": "debugger::Stop", // Stop debugging

      // Tasks
      "space t l": "task::Rerun",
      "space t t": "editor::SpawnNearestTask",

      // Git
      "space g o": "editor::OpenPermalinkToLine",
      "space g b": "git::Blame",
      "space g shift-b": "editor::OpenGitBlameCommit",
    },
  },

  // Duplicate some normal mode keybindings to also operate at the Workspace level
  // outside of an editor pane for consistency.
  {
    "context": "(Workspace && !Editor && !Terminal)",
    "bindings": {
      "space \\": "workspace::ToggleLeftDock",
      "space ;": "workspace::ToggleRightDock",
      "space f": "pane::DeploySearch", // Find in files
      // "space c l": ["agent::NewExternalAgentThread", { "agent": "claude_code" }]
    },
  },
  {
    "context": "Workspace",
    "bindings": {
      "\\ d": "diagnostics::Deploy",
    },
  },
  {
    "context": "Diagnostics",
    "bindings": {
      "\\ shift-d": "diagnostics::Deploy",
    },
  },

  // ============================================================================
  // VISUAL MODE
  // ============================================================================
  {
    "context": "Editor && vim_mode == visual",
    "bindings": {
      "space f": "pane::DeploySearch", // Find in files

      // Search and Replace
      "space s": ["pane::DeploySearch", { "replace_enabled": true }],
      "space *": "pane::DeploySearch", // Find in files

      // Debugger
      "space d e": "debugger::EvaluateSelectedText", // Evaluate selected text
    },
  },

  // ==============
  // Navigation
  // ==============
  {
    "context": "Editor",
    "bindings": {
      // Pane Navigation with Ctrl+hjkl
      "ctrl-h": "workspace::ActivatePaneLeft",
      "ctrl-j": "workspace::ActivatePaneDown",
      "ctrl-k": "workspace::ActivatePaneUp",
      "ctrl-l": "workspace::ActivatePaneRight",

      // Diagnostics
      "\\ d": "diagnostics::DeployCurrentFile",
      "\\ shift-d": "diagnostics::Deploy",
    },
  },

  // ============================================================================
  // WORKSPACE-LEVEL (Works everywhere, including vim modes)
  // ============================================================================
  {
    "context": "Workspace",
    "bindings": {
      // Pane Navigation with Ctrl+hjkl - global fallback
      "ctrl-h": "workspace::ActivatePaneLeft",
      "ctrl-j": "workspace::ActivatePaneDown",
      "ctrl-k": "workspace::ActivatePaneUp",
      "ctrl-l": "workspace::ActivatePaneRight",

      // Git
      "\\ s": "git_panel::ToggleFocus",
    },
  },
  {
    "context": "(Editor && mode == full)",
    "bindings": {
      "] c": "editor::GoToNextChange",
      "[ c": "editor::GoToPreviousChange",
    },
  },
  {
    "context": "(GitPanel && ChangesList)",
    "bindings": {
      "\\ s": "git_panel::Close",
    },
  },
  {
    "context": "AgentPanel",
    "bindings": {
      "alt-cmd-u": "agent::RejectOnce",
    },
  },
  {
    "context": "!ContextEditor > (Editor && mode == full)",
    "bindings": {
      "] c": "editor::GoToHunk",
      "[ c": "editor::GoToPreviousHunk",
    },
  },
  // Always use tab for edit predictions. Use Enter for LSP suggestions
  {
    "context": "(Editor && edit_prediction_conflict && showing_completions)",
    "bindings": {
      "tab": "editor::AcceptEditPrediction",
    },
  },
  {
    "context": "(Editor && edit_prediction_conflict)",
    "bindings": {
      "tab": "editor::AcceptEditPrediction",
    },
  },
  // NERDTree equivalents
  {
    "context": "(ProjectPanel && not_editing)",
    "bindings": {
      "a": "project_panel::NewFile",
      "ctrl-v": "project_panel::OpenSplitVertical",
      "ctrl-x": "project_panel::OpenSplitHorizontal",
    },
  },
  {
    "context": "(FileFinder || FileFinder > Picker > Editor)",
    "bindings": {
      "ctrl-v": "pane::SplitRight",
      "ctrl-x": "pane::SplitDown",
    },
  },
  {
    "context": "(Editor && editor_agent_diff)",
    "bindings": {
      "cmd-y": "agent::Keep",
    },
  },
  {
    "context": "AgentDiff",
    "bindings": {
      "cmd-y": "agent::Keep",
    },
  },
]
